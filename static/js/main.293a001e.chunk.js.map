{"version":3,"sources":["components/WaybackCard.js","pages/Discover.js","pages/Home.js","App.js","index.js","images/logo.png","images/broken-card.png"],"names":["loadedCards","preloadCard","cardId","Image","src","WaybackCard","props","useState","loading","setLoading","badCard","setBadCard","cardReady","useEffect","a","onload","onerror","e","className","role","BrokenCard","alt","DiscoverPage","feed","setFeed","uuid","gkey","fetchTop","useCallback","_near","contract","get_top","limit","connected","then","cards","map","rating","r","parseFloat","key","class","toFixed","HomePage","voting","setVoting","leftReady","setLeftReady","rightReady","setRightReady","voteRequest","requests","slice","forEach","nextRequest","left","right","vote","response","preventDefault","popRequest","request","newRequest","addRequest","onClick","disabled","aria-hidden","NearConfig","window","location","hostname","networkId","nodeUrl","archivalNodeUrl","contractName","walletUrl","fromNear","s","mapAccount","numCards","num_cards","purchaseVolume","purchase_volume","numPurchases","num_purchases","saleProfit","sale_profit","numSales","num_sales","numVotes","num_votes","App","state","isNavCollapsed","account","_initNear","setState","signedIn","accountId","signedAccountId","keyStore","nearAPI","BrowserLocalStorageKeyStore","Object","assign","deps","near","this","walletConnection","getAccountId","connection","provider","block","finality","lastBlockHeight","header","height","viewMethods","changeMethods","getAccount","get_account","account_id","register_account","requestSignIn","signOut","_accountId","c","push","passProps","updateState","logOut","basename","process","to","title","Logo","type","data-bs-toggle","data-bs-target","aria-controls","aria-expanded","aria-label","id","aria-current","href","data-ribbon","exact","path","React","Component","ReactDOM","render","document","getElementById","module","exports"],"mappings":"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","file":"static/js/main.293a001e.chunk.js","sourcesContent":["import React, {useEffect, useState} from 'react';\nimport BrokenCard from \"../images/broken-card.png\"\n\nconst loadedCards = {};\n\nfunction preloadCard(cardId) {\n  if (cardId in loadedCards) {\n    return;\n  }\n  loadedCards[cardId] = true;\n  let a = new Image();\n  a.src = `https://wayback.berryclub.io/img/${cardId}`;\n}\n\nfunction WaybackCard(props) {\n  const [loading, setLoading] = useState(true);\n  const [badCard, setBadCard] = useState(false);\n\n  const cardReady = props.cardReady;\n  const cardId = props.cardId;\n\n  useEffect(() => {\n    setLoading(true);\n    setBadCard(false);\n    cardReady(false);\n    let a = new Image();\n    a.src = `https://wayback.berryclub.io/img/${cardId}`;\n    a.onload = () => {\n      setLoading(false);\n      cardReady(true);\n    }\n    a.onerror = (e) => {\n      setBadCard(true);\n      setLoading(false);\n    }\n  }, [cardId, cardReady])\n\n  return loading ? (\n    <div className=\"d-flex justify-content-center\">\n      <div className=\"spinner-grow\" role=\"status\">\n        <span className=\"visually-hidden\">Loading...</span>\n      </div>\n    </div>\n  ) : badCard ? (\n    <img className={props.className} src={BrokenCard} alt={\"The card is broken\"}/>\n  ) : (\n    <img className={props.className} src={`https://wayback.berryclub.io/img/${cardId}`} alt={`Card #${cardId}`}/>\n  );\n}\n\nexport { preloadCard, WaybackCard };\n","import \"./Discover.scss\";\nimport React, {useCallback, useEffect, useState} from 'react';\nimport uuid from \"react-uuid\";\nimport { WaybackCard } from \"../components/WaybackCard\";\n\nconst FetchLimit = 100;\n\nfunction DiscoverPage(props) {\n  const [loading, setLoading] = useState(true);\n  const [feed, setFeed] = useState([]);\n  const [gkey] = useState(uuid())\n\n  const fetchTop = useCallback(async () => {\n    // const numCards = await props._near.contract.get_num_cards();\n    return await props._near.contract.get_top({\n      limit: FetchLimit,\n    })\n  }, [props._near])\n\n  useEffect(() => {\n    if (props.connected) {\n      setLoading(true);\n      fetchTop().then((feed) => {\n        setFeed(feed);\n        setLoading(false);\n      })\n    }\n  }, [props.connected, fetchTop])\n\n  const cards = feed.map(([rating, cardId]) => {\n    const r = parseFloat(rating) / 1e24;\n    const key = `${gkey}-${cardId}`;\n    return (\n      <div class=\"card card-preview m-2\" key={key}>\n        <WaybackCard className=\"card-img-top\" cardId={cardId} cardReady={() => false}/>\n        <div class=\"card-body\">\n          <h5 class=\"card-title\">#{cardId}</h5>\n          <p class=\"card-text\">\n            {`${r.toFixed(2)} NEAR`}\n          </p>\n        </div>\n      </div>\n    );\n  })\n\n  return (\n    <div>\n      <div className=\"container\">\n        <div className=\"row justify-content-md-center\">\n          {loading ? (\n            <div className=\"col col-12 col-lg-8 col-xl-6\">\n              <div className=\"d-flex justify-content-center\">\n                <div className=\"spinner-grow\" role=\"status\">\n                  <span className=\"visually-hidden\">Loading...</span>\n                </div>\n              </div>\n            </div>\n          ) : (\n            <div className=\"col\">\n              {cards}\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default DiscoverPage;\n","import \"./Home.scss\";\nimport React, {useState} from 'react';\nimport { WaybackCard, preloadCard } from \"../components/WaybackCard\";\n\n\nfunction HomePage(props) {\n  const [voting, setVoting] = useState(false);\n  const [leftReady, setLeftReady] = useState(false);\n  const [rightReady, setRightReady] = useState(false);\n\n  const voteRequest = props.requests ? props.requests[0] : null;\n  if (props.requests) {\n    props.requests.slice(1).forEach((nextRequest) => {\n      preloadCard(nextRequest.left);\n      preloadCard(nextRequest.right);\n    });\n  }\n\n  const vote = async (e, voteRequest, response) => {\n    if (voting) {\n      return;\n    }\n    if (response === \"SelectedLeft\" && !leftReady) {\n      return;\n    }\n    if (response === \"SelectedRight\" && !rightReady) {\n      return;\n    }\n    e.preventDefault();\n    setVoting(true);\n    props.popRequest();\n    const newRequest = await props._near.contract.vote({\n      request: voteRequest,\n      response,\n    }, \"100000000000000\");\n    props.addRequest(newRequest, () => setVoting(false));\n  }\n\n  return (\n    <div>\n      <div className=\"container\">\n        {voteRequest ? (\n          <div>\n            <div className=\"row justify-content-md-center mb-3\">\n              <div className=\"col col-sm-6\">\n                <div className={`card-picker${(voting || !leftReady) ? \" disabled\": \"\"}`} onClick={(e) => vote(e, voteRequest, \"SelectedLeft\")}>\n                  <WaybackCard className=\"img-fluid\" cardId={voteRequest.left} cardReady={setLeftReady}/>\n                </div>\n              </div>\n              <div className=\"col col-sm-6\">\n                <div className={`card-picker${(voting || !rightReady) ? \" disabled\": \"\"}`} onClick={(e) => vote(e, voteRequest,\"SelectedRight\")}>\n                  <WaybackCard className=\"img-fluid\" cardId={voteRequest.right} cardReady={setRightReady}/>\n                </div>\n              </div>\n            </div>\n            <div className=\"row justify-content-md-center\">\n              {voting ? (\n                <button disabled={true} className=\"btn btn-lg btn-secondary\">\n                  <span className=\"spinner-grow spinner-grow-sm\" role=\"status\" aria-hidden=\"true\"></span>\n                  <span className=\"visually-hidden\">Loading...</span>\n                    {' '}Voting\n                </button>\n              ) : (\n                <button className=\"btn btn-lg btn-danger\" onClick={(e) => vote(e, voteRequest,\"Skipped\")}>Skip both cards</button>\n              )}\n            </div>\n          </div>\n        ) : (\n          <div className=\"d-flex justify-content-center\">\n            <div className=\"spinner-grow\" role=\"status\">\n              <span className=\"visually-hidden\">Loading...</span>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\nexport default HomePage;\n","import React from 'react';\nimport \"error-polyfill\";\nimport 'bootstrap/dist/js/bootstrap.bundle';\nimport 'bootstrap/dist/css/bootstrap.min.css';\nimport \"./App.scss\";\nimport './gh-fork-ribbon.css';\nimport * as nearAPI from 'near-api-js'\nimport Logo from \"./images/logo.png\"\nimport DiscoverPage from \"./pages/Discover\";\nimport HomePage from \"./pages/Home\";\nimport {HashRouter as Router, Link, Route, Switch} from 'react-router-dom'\n\nconst IsMainnet = window.location.hostname === \"berry.cards\";\nconst TestNearConfig = {\n  networkId: 'testnet',\n  nodeUrl: 'https://rpc.testnet.near.org',\n  archivalNodeUrl: 'https://rpc.testnet.internal.near.org',\n  contractName: 'dev-1614562672208-5026434',\n  walletUrl: 'https://wallet.testnet.near.org',\n};\n\nconst MainNearConfig = {\n  networkId: 'testnet',\n  nodeUrl: 'https://rpc.testnet.near.org',\n  archivalNodeUrl: 'https://rpc.testnet.internal.near.org',\n  contractName: 'dev-1614562672208-5026434',\n  walletUrl: 'https://wallet.testnet.near.org',\n};\n\n// const MainNearConfig = {\n//   networkId: 'mainnet',\n//   nodeUrl: 'https://rpc.mainnet.near.org',\n//   contractName: 'berryclub.ek.near',\n//   walletUrl: 'https://wallet.near.org',\n// };\nconst NearConfig = IsMainnet ? MainNearConfig : TestNearConfig;\n\nconst fromNear = (s) => parseFloat(s) / 1e24;\n\nconst mapAccount = (a) => {\n  return {\n    requests: a.requests,\n    numCards: a.num_cards,\n    purchaseVolume: fromNear(a.purchase_volume),\n    numPurchases: a.num_purchases,\n    saleProfit: fromNear(a.sale_profit),\n    numSales: a.num_sales,\n    numVotes: a.num_votes,\n  };\n}\n\nclass App extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this._near = {};\n\n    this.state = {\n      connected: false,\n      isNavCollapsed: true,\n      account: null,\n      requests: null,\n    };\n\n    this._initNear().then(() => {\n      this.setState({\n        signedIn: !!this._near.accountId,\n        signedAccountId: this._near.accountId,\n        connected: true,\n      });\n    });\n  }\n\n\n  async _initNear() {\n    const keyStore = new nearAPI.keyStores.BrowserLocalStorageKeyStore();\n    const near = await nearAPI.connect(Object.assign({deps: {keyStore}}, NearConfig));\n    this._near.keyStore = keyStore;\n    this._near.near = near;\n\n    this._near.walletConnection = new nearAPI.WalletConnection(near, NearConfig.contractName);\n    this._near.accountId = this._near.walletConnection.getAccountId();\n\n    this._near.account = this._near.walletConnection.account();\n    const block = await this._near.account.connection.provider.block({ finality: 'final' });\n    this._near.lastBlockHeight = block.header.height;\n    this._near.contract = new nearAPI.Contract(this._near.account, NearConfig.contractName, {\n      viewMethods: ['get_account', 'get_accounts', 'get_num_cards', 'get_top', 'get_rating', 'get_trade_data', 'get_card_info'],\n      changeMethods: ['register_account', 'vote', 'buy_card'],\n    });\n\n    this._near.getAccount = async (accountId) => {\n      const a = await this._near.contract.get_account({account_id: accountId});\n      return a ? mapAccount(a) : null;\n    };\n\n    if (this._near.accountId) {\n      let account = await this._near.getAccount(this._near.accountId);\n      if (account === null) {\n        account = mapAccount(await this._near.contract.register_account());\n      }\n      this.setState({\n        account,\n        requests: account.requests,\n      });\n    }\n  }\n\n\n  async requestSignIn(e) {\n    e.preventDefault();\n    const appTitle = 'Berry Cards';\n    await this._near.walletConnection.requestSignIn(\n      NearConfig.contractName,\n      appTitle\n    )\n    return false;\n  }\n\n  async logOut() {\n    this._near.walletConnection.signOut();\n    this._near.accountId = null;\n    this.setState({\n      signedIn: !!this._accountId,\n      signedAccountId: this._accountId,\n    })\n  }\n\n  popRequest(c) {\n    const requests = this.state.requests.slice(1);\n    this.setState({\n      requests,\n    }, c);\n  }\n\n  addRequest(r, c) {\n    const requests = this.state.requests.slice(0);\n    requests.push(r);\n    this.setState({\n      requests,\n    }, c);\n  }\n\n  render() {\n    const passProps = {\n      _near: this._near,\n      updateState: (s, c) => this.setState(s, c),\n      popRequest: (c) => this.popRequest(c),\n      addRequest: (r, c) => this.addRequest(r, c),\n      ...this.state\n    };\n    const header = !this.state.connected ? (\n      <div>Connecting... <span className=\"spinner-grow spinner-grow-sm\" role=\"status\" aria-hidden=\"true\"></span></div>\n    ) : (this.state.signedIn ? (\n      <div>\n        <button\n          className=\"btn btn-outline-secondary\"\n          onClick={() => this.logOut()}>Sign out ({this.state.signedAccountId})</button>\n      </div>\n    ) : (\n      <div>\n        <button\n          className=\"btn btn-primary\"\n          onClick={(e) => this.requestSignIn(e)}>Sign in with NEAR Wallet</button>\n      </div>\n    ));\n\n    return (\n      <div className=\"App\">\n        <Router basename={process.env.PUBLIC_URL}>\n          <nav className=\"navbar navbar-expand-lg navbar-light bg-light mb-3\">\n            <div className=\"container-fluid\">\n              <Link className=\"navbar-brand\" to=\"/\" title=\"NEAR.fm\">\n                <img src={Logo} alt=\"Berry Cards\" className=\"d-inline-block align-middle\" />\n                [TESTNET] Berry Cards\n              </Link>\n              <button className=\"navbar-toggler\" type=\"button\" data-bs-toggle=\"collapse\"\n                      data-bs-target=\"#navbarSupportedContent\" aria-controls=\"navbarSupportedContent\"\n                      aria-expanded=\"false\" aria-label=\"Toggle navigation\">\n                <span className=\"navbar-toggler-icon\"></span>\n              </button>\n              <div className=\"collapse navbar-collapse\" id=\"navbarSupportedContent\">\n                <ul className=\"navbar-nav me-auto mb-2 mb-lg-0\">\n                  <li className=\"nav-item\">\n                    <Link className=\"nav-link\" aria-current=\"page\" to=\"/\">Home</Link>\n                  </li>\n                  {this.state.signedIn && (\n                    <li className=\"nav-item\">\n                      <Link className=\"nav-link\" aria-current=\"page\" to=\"/discover\">Discover</Link>\n                    </li>\n                  )}\n                </ul>\n                <form className=\"d-flex\">\n                  {header}\n                </form>\n              </div>\n            </div>\n          </nav>\n\n          <a className=\"github-fork-ribbon right-bottom fixed\" href=\"https://github.com/evgenykuzyakov/berry-hot\" data-ribbon=\"Fork me on GitHub\"\n             title=\"Fork me on GitHub\">Fork me on GitHub</a>\n\n          <Switch>\n            <Route exact path={\"/\"}>\n              {this.state.signedIn ? (\n                <HomePage {...passProps}/>\n              ) : (\n                <DiscoverPage {...passProps}/>\n              )}\n            </Route>\n            <Route exact path={\"/discover\"}>\n              <DiscoverPage {...passProps}/>\n            </Route>\n          </Switch>\n        </Router>\n      </div>\n    )\n  }\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(<App />, document.getElementById('root'));\n","module.exports = __webpack_public_path__ + \"static/media/logo.f18e89c9.png\";","module.exports = __webpack_public_path__ + \"static/media/broken-card.f18e89c9.png\";"],"sourceRoot":""}