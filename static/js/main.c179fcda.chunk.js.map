{"version":3,"sources":["components/WaybackCard.js","components/BuyButton.js","pages/Discover.js","pages/Home.js","App.js","index.js","images/logo.png","images/broken-card.png"],"names":["loadedCards","preloadCard","cardId","Image","src","WaybackCard","props","useState","loading","setLoading","badCard","setBadCard","cardReady","useEffect","a","onload","onerror","e","className","role","BrokenCard","alt","fromNear","s","parseFloat","BuyButton","preventDefault","_near","contract","buy_card","card_id","price","onClick","buyCard","toFixed","DiscoverPage","feed","setFeed","uuid","gkey","fetchTop","useCallback","get_top","limit","connected","then","cards","map","rating","key","HomePage","leftReady","setLeftReady","rightReady","setRightReady","Promise","resolve","votingPromise","voteRequest","requests","slice","forEach","nextRequest","left","right","vote","response","popRequest","request","newRequest","addRequest","NearConfig","window","location","hostname","networkId","nodeUrl","archivalNodeUrl","contractName","walletUrl","mapAccount","numCards","num_cards","purchaseVolume","purchase_volume","numPurchases","num_purchases","saleProfit","sale_profit","numSales","num_sales","numVotes","num_votes","App","state","isNavCollapsed","account","_initNear","setState","signedIn","accountId","signedAccountId","keyStore","nearAPI","BrowserLocalStorageKeyStore","Object","assign","deps","near","this","walletConnection","getAccountId","connection","provider","block","finality","lastBlockHeight","header","height","viewMethods","changeMethods","getAccount","get_account","account_id","register_account","requestSignIn","signOut","_accountId","c","r","push","passProps","updateState","logOut","aria-hidden","basename","process","to","title","Logo","type","data-bs-toggle","data-bs-target","aria-controls","aria-expanded","aria-label","id","aria-current","href","data-ribbon","exact","path","React","Component","ReactDOM","render","document","getElementById","module","exports"],"mappings":"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","file":"static/js/main.c179fcda.chunk.js","sourcesContent":["import React, {useEffect, useState} from 'react';\nimport BrokenCard from \"../images/broken-card.png\"\n\nconst loadedCards = {};\n\nfunction preloadCard(cardId) {\n  if (cardId in loadedCards) {\n    return;\n  }\n  loadedCards[cardId] = true;\n  let a = new Image();\n  a.src = `https://wayback.berryclub.io/img/${cardId}`;\n}\n\nfunction WaybackCard(props) {\n  const [loading, setLoading] = useState(true);\n  const [badCard, setBadCard] = useState(false);\n\n  const cardReady = props.cardReady;\n  const cardId = props.cardId;\n\n  useEffect(() => {\n    setLoading(true);\n    setBadCard(false);\n    cardReady(false);\n    let a = new Image();\n    a.src = `https://wayback.berryclub.io/img/${cardId}`;\n    a.onload = () => {\n      setLoading(false);\n      cardReady(true);\n    }\n    a.onerror = (e) => {\n      setBadCard(true);\n      setLoading(false);\n    }\n  }, [cardId, cardReady])\n\n  return loading ? (\n    <div className=\"d-flex justify-content-center\">\n      <div className=\"spinner-grow\" role=\"status\">\n        <span className=\"visually-hidden\">Loading...</span>\n      </div>\n    </div>\n  ) : badCard ? (\n    <img className={props.className} src={BrokenCard} alt={\"The card is broken\"}/>\n  ) : (\n    <img className={props.className} src={`https://wayback.berryclub.io/img/${cardId}`} alt={`Card #${cardId}`}/>\n  );\n}\n\nexport { preloadCard, WaybackCard };\n","import React from 'react';\n\nconst fromNear = (s) => parseFloat(s) / 1e24;\n\nfunction BuyButton(props) {\n  async function buyCard(e) {\n    e.preventDefault();\n    await props._near.contract.buy_card({card_id: props.cardId}, \"100000000000000\", props.price)\n  }\n\n  return (\n    <button className=\"btn btn-success\" onClick={(e) => buyCard(e)}>\n      Buy for {fromNear(props.price).toFixed(2)} NEAR\n    </button>\n  );\n}\n\nexport { fromNear, BuyButton };\n","import \"./Discover.scss\";\nimport React, {useCallback, useEffect, useState} from 'react';\nimport uuid from \"react-uuid\";\nimport { WaybackCard } from \"../components/WaybackCard\";\nimport {BuyButton} from \"../components/BuyButton\";\n\nconst FetchLimit = 40;\n\nfunction DiscoverPage(props) {\n  const [loading, setLoading] = useState(true);\n  const [feed, setFeed] = useState([]);\n  const [gkey] = useState(uuid())\n\n  const fetchTop = useCallback(async () => {\n    // const numCards = await props._near.contract.get_num_cards();\n    return await props._near.contract.get_top({\n      limit: FetchLimit,\n    })\n  }, [props._near])\n\n  useEffect(() => {\n    if (props.connected) {\n      setLoading(true);\n      fetchTop().then((feed) => {\n        setFeed(feed);\n        setLoading(false);\n      })\n    }\n  }, [props.connected, fetchTop])\n\n  const cards = feed.map(([rating, cardId]) => {\n    const key = `${gkey}-${cardId}`;\n    return (\n      <div className=\"card card-preview m-2\" key={key}>\n        <WaybackCard className=\"card-img-top\" cardId={cardId} cardReady={() => false}/>\n        <div className=\"card-body\">\n          <h5 className=\"card-title\">#{cardId}</h5>\n          <p className=\"card-text\">\n            <BuyButton {...props} cardId={cardId} price={rating} />\n          </p>\n        </div>\n      </div>\n    );\n  })\n\n  return (\n    <div>\n      <div className=\"container\">\n        <div className=\"row justify-content-md-center\">\n          {loading ? (\n            <div className=\"col col-12 col-lg-8 col-xl-6\">\n              <div className=\"d-flex justify-content-center\">\n                <div className=\"spinner-grow\" role=\"status\">\n                  <span className=\"visually-hidden\">Loading...</span>\n                </div>\n              </div>\n            </div>\n          ) : (\n            <div className=\"col\">\n              {cards}\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default DiscoverPage;\n","import \"./Home.scss\";\nimport React, {useState} from 'react';\nimport { WaybackCard, preloadCard } from \"../components/WaybackCard\";\n\n\nfunction HomePage(props) {\n  const [leftReady, setLeftReady] = useState(false);\n  const [rightReady, setRightReady] = useState(false);\n  const [votingPromise] = useState(Promise.resolve());\n\n  const voteRequest = props.requests ? props.requests[0] : null;\n\n  if (props.requests) {\n    props.requests.slice(1).forEach((nextRequest) => {\n      preloadCard(nextRequest.left);\n      preloadCard(nextRequest.right);\n    });\n  }\n\n  const vote = async (e, voteRequest, response) => {\n    e.preventDefault();\n    if (response === \"SelectedLeft\" && !leftReady) {\n      return;\n    }\n    if (response === \"SelectedRight\" && !rightReady) {\n      return;\n    }\n    props.popRequest();\n    votingPromise.then(async () => {\n      const newRequest = await props._near.contract.vote({\n        request: voteRequest,\n        response,\n      }, \"100000000000000\");\n      props.addRequest(newRequest);\n    });\n  }\n\n  return (\n    <div>\n      <div className=\"container\">\n        {voteRequest ? (\n          <div>\n            <div className=\"row justify-content-md-center mb-3\">\n              <div className=\"col col-sm-6\">\n                <div className={`card-picker${!leftReady ? \" disabled\": \"\"}`} onClick={(e) => vote(e, voteRequest, \"SelectedLeft\")}>\n                  <WaybackCard className=\"img-fluid\" cardId={voteRequest.left} cardReady={setLeftReady}/>\n                </div>\n              </div>\n              <div className=\"col col-sm-6\">\n                <div className={`card-picker${!rightReady ? \" disabled\": \"\"}`} onClick={(e) => vote(e, voteRequest,\"SelectedRight\")}>\n                  <WaybackCard className=\"img-fluid\" cardId={voteRequest.right} cardReady={setRightReady}/>\n                </div>\n              </div>\n            </div>\n            <div className=\"row justify-content-md-center\">\n              {false ? (\n                <button disabled={true} className=\"btn btn-lg btn-secondary\">\n                  <span className=\"spinner-grow spinner-grow-sm\" role=\"status\" aria-hidden=\"true\"></span>\n                  <span className=\"visually-hidden\">Loading...</span>\n                    {' '}Voting\n                </button>\n              ) : (\n                <button className=\"btn btn-lg btn-danger\" onClick={(e) => vote(e, voteRequest,\"Skipped\")}>Skip both cards</button>\n              )}\n            </div>\n          </div>\n        ) : (\n          <div className=\"d-flex justify-content-center\">\n            <div className=\"spinner-grow\" role=\"status\">\n              <span className=\"visually-hidden\">Loading...</span>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\nexport default HomePage;\n","import React from 'react';\nimport \"error-polyfill\";\nimport 'bootstrap/dist/js/bootstrap.bundle';\nimport 'bootstrap/dist/css/bootstrap.min.css';\nimport \"./App.scss\";\nimport './gh-fork-ribbon.css';\nimport * as nearAPI from 'near-api-js'\nimport Logo from \"./images/logo.png\"\nimport DiscoverPage from \"./pages/Discover\";\nimport HomePage from \"./pages/Home\";\nimport {HashRouter as Router, Link, Route, Switch} from 'react-router-dom'\nimport {fromNear} from \"./components/BuyButton\";\n\nconst IsMainnet = window.location.hostname === \"berry.cards\";\nconst TestNearConfig = {\n  networkId: 'testnet',\n  nodeUrl: 'https://rpc.testnet.near.org',\n  archivalNodeUrl: 'https://rpc.testnet.internal.near.org',\n  contractName: 'dev-1614562672208-5026434',\n  walletUrl: 'https://wallet.testnet.near.org',\n};\n\nconst MainNearConfig = {\n  networkId: 'testnet',\n  nodeUrl: 'https://rpc.testnet.near.org',\n  archivalNodeUrl: 'https://rpc.testnet.internal.near.org',\n  contractName: 'dev-1614562672208-5026434',\n  walletUrl: 'https://wallet.testnet.near.org',\n};\n\n// const MainNearConfig = {\n//   networkId: 'mainnet',\n//   nodeUrl: 'https://rpc.mainnet.near.org',\n//   contractName: 'berryclub.ek.near',\n//   walletUrl: 'https://wallet.near.org',\n// };\nconst NearConfig = IsMainnet ? MainNearConfig : TestNearConfig;\n\nconst mapAccount = (a) => {\n  return {\n    requests: a.requests,\n    numCards: a.num_cards,\n    purchaseVolume: fromNear(a.purchase_volume),\n    numPurchases: a.num_purchases,\n    saleProfit: fromNear(a.sale_profit),\n    numSales: a.num_sales,\n    numVotes: a.num_votes,\n  };\n}\n\nclass App extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this._near = {};\n\n    this.state = {\n      connected: false,\n      isNavCollapsed: true,\n      account: null,\n      requests: null,\n    };\n\n    this._initNear().then(() => {\n      this.setState({\n        signedIn: !!this._near.accountId,\n        signedAccountId: this._near.accountId,\n        connected: true,\n      });\n    });\n  }\n\n\n  async _initNear() {\n    const keyStore = new nearAPI.keyStores.BrowserLocalStorageKeyStore();\n    const near = await nearAPI.connect(Object.assign({deps: {keyStore}}, NearConfig));\n    this._near.keyStore = keyStore;\n    this._near.near = near;\n\n    this._near.walletConnection = new nearAPI.WalletConnection(near, NearConfig.contractName);\n    this._near.accountId = this._near.walletConnection.getAccountId();\n\n    this._near.account = this._near.walletConnection.account();\n    const block = await this._near.account.connection.provider.block({ finality: 'final' });\n    this._near.lastBlockHeight = block.header.height;\n    this._near.contract = new nearAPI.Contract(this._near.account, NearConfig.contractName, {\n      viewMethods: ['get_account', 'get_accounts', 'get_num_cards', 'get_top', 'get_rating', 'get_trade_data', 'get_card_info'],\n      changeMethods: ['register_account', 'vote', 'buy_card'],\n    });\n\n    this._near.getAccount = async (accountId) => {\n      const a = await this._near.contract.get_account({account_id: accountId});\n      return a ? mapAccount(a) : null;\n    };\n\n    if (this._near.accountId) {\n      let account = await this._near.getAccount(this._near.accountId);\n      if (account === null) {\n        account = mapAccount(await this._near.contract.register_account());\n      }\n      this.setState({\n        account,\n        requests: account.requests,\n      });\n    }\n  }\n\n\n  async requestSignIn(e) {\n    e.preventDefault();\n    const appTitle = 'Berry Cards';\n    await this._near.walletConnection.requestSignIn(\n      NearConfig.contractName,\n      appTitle\n    )\n    return false;\n  }\n\n  async logOut() {\n    this._near.walletConnection.signOut();\n    this._near.accountId = null;\n    this.setState({\n      signedIn: !!this._accountId,\n      signedAccountId: this._accountId,\n    })\n  }\n\n  popRequest(c) {\n    const requests = this.state.requests.slice(1);\n    this.setState({\n      requests,\n    }, c);\n  }\n\n  addRequest(r, c) {\n    const requests = this.state.requests.slice(0);\n    requests.push(r);\n    this.setState({\n      requests,\n    }, c);\n  }\n\n  render() {\n    const passProps = {\n      _near: this._near,\n      updateState: (s, c) => this.setState(s, c),\n      popRequest: (c) => this.popRequest(c),\n      addRequest: (r, c) => this.addRequest(r, c),\n      ...this.state\n    };\n    const header = !this.state.connected ? (\n      <div>Connecting... <span className=\"spinner-grow spinner-grow-sm\" role=\"status\" aria-hidden=\"true\"></span></div>\n    ) : (this.state.signedIn ? (\n      <div>\n        <button\n          className=\"btn btn-outline-secondary\"\n          onClick={() => this.logOut()}>Sign out ({this.state.signedAccountId})</button>\n      </div>\n    ) : (\n      <div>\n        <button\n          className=\"btn btn-primary\"\n          onClick={(e) => this.requestSignIn(e)}>Sign in with NEAR Wallet</button>\n      </div>\n    ));\n\n    return (\n      <div className=\"App\">\n        <Router basename={process.env.PUBLIC_URL}>\n          <nav className=\"navbar navbar-expand-lg navbar-light bg-light mb-3\">\n            <div className=\"container-fluid\">\n              <Link className=\"navbar-brand\" to=\"/\" title=\"NEAR.fm\">\n                <img src={Logo} alt=\"Berry Cards\" className=\"d-inline-block align-middle\" />\n                [TESTNET] Berry Cards\n              </Link>\n              <button className=\"navbar-toggler\" type=\"button\" data-bs-toggle=\"collapse\"\n                      data-bs-target=\"#navbarSupportedContent\" aria-controls=\"navbarSupportedContent\"\n                      aria-expanded=\"false\" aria-label=\"Toggle navigation\">\n                <span className=\"navbar-toggler-icon\"></span>\n              </button>\n              <div className=\"collapse navbar-collapse\" id=\"navbarSupportedContent\">\n                <ul className=\"navbar-nav me-auto mb-2 mb-lg-0\">\n                  <li className=\"nav-item\">\n                    <Link className=\"nav-link\" aria-current=\"page\" to=\"/\">Home</Link>\n                  </li>\n                  {this.state.signedIn && (\n                    <li className=\"nav-item\">\n                      <Link className=\"nav-link\" aria-current=\"page\" to=\"/discover\">Discover</Link>\n                    </li>\n                  )}\n                </ul>\n                <form className=\"d-flex\">\n                  {header}\n                </form>\n              </div>\n            </div>\n          </nav>\n\n          <a className=\"github-fork-ribbon right-bottom fixed\" href=\"https://github.com/evgenykuzyakov/berry-hot\" data-ribbon=\"Fork me on GitHub\"\n             title=\"Fork me on GitHub\">Fork me on GitHub</a>\n\n          <Switch>\n            <Route exact path={\"/\"}>\n              {this.state.signedIn ? (\n                <HomePage {...passProps}/>\n              ) : (\n                <DiscoverPage {...passProps}/>\n              )}\n            </Route>\n            <Route exact path={\"/discover\"}>\n              <DiscoverPage {...passProps}/>\n            </Route>\n          </Switch>\n        </Router>\n      </div>\n    )\n  }\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(<App />, document.getElementById('root'));\n","module.exports = __webpack_public_path__ + \"static/media/logo.f18e89c9.png\";","module.exports = __webpack_public_path__ + \"static/media/broken-card.f18e89c9.png\";"],"sourceRoot":""}