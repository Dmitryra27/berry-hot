(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{100:function(e,t,a){e.exports=a.p+"static/media/tomato.9239fac3.png"},101:function(e,t,a){e.exports=a.p+"static/media/avocado.f0698336.gif"},108:function(e,t,a){e.exports=a(204)},113:function(e,t,a){},132:function(e,t,a){},133:function(e,t,a){},138:function(e,t){},146:function(e,t){},161:function(e,t){},163:function(e,t){},195:function(e,t,a){},196:function(e,t,a){},201:function(e,t,a){},204:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(96),s=a.n(c),l=(a(113),a(106)),i=a(1),o=a.n(i),u=a(7),d=a(97),m=a(98),b=a(107),f=a(105),p=(a(55),a(130),a(131),a(132),a(133),a(33)),v=a(99),h=a.n(v),g=a(4),E=(a(195),a(26)),N=a.n(E),_=(a(196),a(100)),y=a.n(_),j=a(101),w=a.n(j),O={};function k(e){e in O||(O[e]=!0,(new Image).src="https://wayback.berryclub.io/img/".concat(e))}function x(e){var t=Object(n.useState)(!0),a=Object(g.a)(t,2),c=a[0],s=a[1],l=Object(n.useState)(!1),i=Object(g.a)(l,2),o=i[0],u=i[1],d=e.cardReady,m=e.cardId;return Object(n.useEffect)((function(){s(!0),u(!1),d(!1);var e=new Image;e.src="https://wayback.berryclub.io/img/".concat(m),e.onload=function(){s(!1),d(!0)},e.onerror=function(e){u(!0),s(!1)}}),[m,d]),c?r.a.createElement("img",{className:e.className,src:w.a,alt:"The card #".concat(m," is loading")}):o?r.a.createElement("img",{className:e.className,src:y.a,alt:"The card #".concat(m," is broken")}):r.a.createElement("img",{className:e.className,src:"https://wayback.berryclub.io/img/".concat(m),alt:"Card #".concat(m)})}var I=a(21),S=function(e){return parseFloat(e)/1e24};function C(e){function t(){return(t=Object(u.a)(o.a.mark((function t(a){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a.preventDefault(),t.next=3,e._near.contract.buy_card({card_id:e.cardId},"100000000000000",e.price);case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return r.a.createElement("button",{className:"btn btn-success",disabled:!e.signedIn,onClick:function(e){return function(e){return t.apply(this,arguments)}(e)}},"Buy for ",S(e.price).toFixed(2)," NEAR")}var R=a(104),q=function(e){return e?{ownerId:e.owner_id,purchasePrice:S(e.purchase_price),purchaseTime:new Date(parseFloat(e.purchase_time)/1e6),volume:S(e.volume)}:{ownerId:null,purchasePrice:0,purchaseTime:null,volume:0}};var A=function(e){var t=Object(n.useState)(null),a=Object(g.a)(t,2),c=a[0],s=a[1],l=e.cardId,i=e.refreshTime,d=e.hidden,m=Object(n.useCallback)(Object(u.a)(o.a.mark((function t(){var a,n;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._near.contract.get_rating({card_id:l});case 2:return a=t.sent,t.t0=q,t.next=6,e._near.contract.get_card_info({card_id:l});case 6:return t.t1=t.sent,(n=(0,t.t0)(t.t1)).refreshTime=i,n.rating=a,t.abrupt("return",n);case 11:case"end":return t.stop()}}),t)}))),[e._near,l,i]);return Object(n.useEffect)((function(){e.connected&&!d&&(k(l),m().then(s))}),[e.connected,m,l,d]),c?r.a.createElement("div",{className:"card m-2"},r.a.createElement(x,{className:"card-img-top",cardId:l,cardReady:function(){return!1}}),r.a.createElement("div",{className:"card-body text-start"},r.a.createElement("h3",null,"#",l),c.ownerId?r.a.createElement("div",null,r.a.createElement("p",null,"Owned by @",c.ownerId,r.a.createElement("br",null),"Purchased ",r.a.createElement(R.a,{datetime:c.purchaseTime}),r.a.createElement("br",null),"Purchased for ",c.purchasePrice.toFixed(2)," NEAR",r.a.createElement("br",null))):r.a.createElement("div",null,r.a.createElement("p",null,"Not owned by anyone."))),r.a.createElement("div",{className:"card-footer"},r.a.createElement("p",{className:"card-text text-center"},r.a.createElement(C,Object.assign({},e,{cardId:l,price:c.rating}))))):r.a.createElement("div",{className:"card m-2"},r.a.createElement("div",{className:"d-flex justify-content-center"},r.a.createElement("div",{className:"spinner-grow",role:"status"},r.a.createElement("span",{className:"visually-hidden"},"Loading..."))))};var T=function(e){var t=Object(n.useState)(!0),a=Object(g.a)(t,2),c=a[0],s=a[1],l=Object(n.useState)(N()()),i=Object(g.a)(l,1)[0];return r.a.createElement("div",null,r.a.createElement("button",{className:"btn btn-success",disabled:!e.signedIn,"data-bs-toggle":"modal","data-bs-target":"#card-modal-".concat(i),onClick:function(e){return s(!1)}},S(e.price).toFixed(2)," NEAR"),r.a.createElement("div",{className:"modal fade",id:"card-modal-".concat(i),tabIndex:"-1","aria-labelledby":"card-label-".concat(i),"aria-hidden":!0},r.a.createElement("div",{className:"modal-dialog modal-dialog-centered"},r.a.createElement("div",{className:"modal-content"},r.a.createElement("div",{className:"modal-header"},r.a.createElement("h5",{className:"modal-title",id:"card-label-".concat(i)},"Card #",e.cardId),r.a.createElement("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})),r.a.createElement("div",{className:"modal-body"},r.a.createElement(A,Object.assign({},e,{hidden:c}))),r.a.createElement("div",{className:"modal-footer"},r.a.createElement("button",{type:"button",className:"btn btn-secondary","data-bs-dismiss":"modal"},"Close"))))))};var L=function(e){var t=Object(n.useState)(e.rating),a=Object(g.a)(t,2),c=a[0],s=a[1],l=e.cardId,i=e.rating,d=Object(n.useCallback)(Object(u.a)(o.a.mark((function t(){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._near.contract.get_rating({card_id:l});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)}))),[e._near,l]);return Object(n.useEffect)((function(){e.connected&&(i?s(i):d().then(s))}),[e.connected,i,d]),e.cardId?r.a.createElement("div",{className:"card card-preview m-2"},r.a.createElement(I.b,{to:"/c/".concat(l)},r.a.createElement(x,{className:"card-img-top",cardId:l,cardReady:function(){return!1}})),r.a.createElement("div",{className:"card-body"},"#",l),r.a.createElement("div",{className:"card-footer text-center"},r.a.createElement(T,Object.assign({},e,{cardId:l,price:c})))):r.a.createElement("div",{className:"card card-preview m-2"},r.a.createElement("div",{className:"d-flex justify-content-center"},r.a.createElement("div",{className:"spinner-grow",role:"status"},r.a.createElement("span",{className:"visually-hidden"},"Loading..."))))};var B=function(e){var t=Object(n.useState)(!0),a=Object(g.a)(t,2),c=a[0],s=a[1],l=Object(n.useState)([]),i=Object(g.a)(l,2),d=i[0],m=i[1],b=Object(n.useState)(N()()),f=Object(g.a)(b,1)[0],p=Object(n.useCallback)(Object(u.a)(o.a.mark((function t(){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._near.contract.get_top({limit:40});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)}))),[e._near]);Object(n.useEffect)((function(){e.connected&&(s(!0),p().then((function(e){m(e),s(!1)})))}),[e.connected,p]);var v=d.map((function(t){var a=Object(g.a)(t,2),n=a[0],c=a[1],s="".concat(f,"-").concat(c);return r.a.createElement(L,Object.assign({},e,{key:s,cardId:c,rating:n}))}));return r.a.createElement("div",null,r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"row justify-content-md-center"},c?r.a.createElement("div",{className:"col col-12 col-lg-8 col-xl-6"},r.a.createElement("div",{className:"d-flex justify-content-center"},r.a.createElement("div",{className:"spinner-grow",role:"status"},r.a.createElement("span",{className:"visually-hidden"},"Loading...")))):r.a.createElement("div",{className:"col"},v))))};a(201);var F=function(e){var t=Object(n.useState)(!1),a=Object(g.a)(t,2),c=a[0],s=a[1],l=Object(n.useState)(!1),i=Object(g.a)(l,2),d=i[0],m=i[1],b=Object(n.useState)(Promise.resolve()),f=Object(g.a)(b,1)[0],p=Object(n.useState)(N()()),v=Object(g.a)(p,1)[0],h=e.requests?e.requests[0]:null;e.requests&&e.requests.slice(1).forEach((function(e){k(e.left),k(e.right)}));var E=function(){var t=Object(u.a)(o.a.mark((function t(a,n,r){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a.preventDefault(),"SelectedLeft"!==r||c){t.next=3;break}return t.abrupt("return");case 3:if("SelectedRight"!==r||d){t.next=5;break}return t.abrupt("return");case 5:e.popRequest(),f.then(Object(u.a)(o.a.mark((function t(){var a,c;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._near.contract.vote({request:n,response:r},"100000000000000");case 2:a=t.sent,"SelectedLeft"!==r&&"SelectedRight"!==r||(c="SelectedLeft"===r?n.left:n.right,e.addRecentCard(c)),e.addRequest(a);case 5:case"end":return t.stop()}}),t)}))));case 7:case"end":return t.stop()}}),t)})));return function(e,a,n){return t.apply(this,arguments)}}(),_=e.recentCards.map((function(t){var a="".concat(v,"-").concat(t);return r.a.createElement(L,Object.assign({},e,{key:a,cardId:t}))}));return r.a.createElement("div",null,r.a.createElement("div",{className:"container"},h?r.a.createElement("div",null,r.a.createElement("div",{className:"row justify-content-md-center mb-3"},r.a.createElement("div",{className:"col col-sm-6"},r.a.createElement("div",{className:"card-picker".concat(c?"":" disabled"),onClick:function(e){return E(e,h,"SelectedLeft")}},r.a.createElement(x,{className:"img-fluid",cardId:h.left,cardReady:s}))),r.a.createElement("div",{className:"col col-sm-6"},r.a.createElement("div",{className:"card-picker".concat(d?"":" disabled"),onClick:function(e){return E(e,h,"SelectedRight")}},r.a.createElement(x,{className:"img-fluid",cardId:h.right,cardReady:m})))),r.a.createElement("div",{className:"row justify-content-md-center mb-3"},r.a.createElement("button",{className:"btn btn-lg btn-danger",onClick:function(e){return E(e,h,"Skipped")}},"Skip both cards"))):r.a.createElement("div",{className:"d-flex justify-content-center"},r.a.createElement("div",{className:"spinner-grow",role:"status"},r.a.createElement("span",{className:"visually-hidden"},"Loading..."))),r.a.createElement("div",{className:"row justify-content-md-center mb-3"},_.length>0&&r.a.createElement("div",null,r.a.createElement("h3",null,"Recent votes"),_))))},P=a(2),K=a(53),D=a.n(K);var H=function(e){var t=Object(P.f)().cardId;return r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"row justify-content-md-center"},r.a.createElement("div",{className:"col col-12 col-lg-8 col-xl-6"},r.a.createElement(A,Object.assign({},e,{cardId:parseInt(t)})))))},G=(window.location.hostname,{networkId:"testnet",nodeUrl:"https://rpc.testnet.near.org",archivalNodeUrl:"https://rpc.testnet.internal.near.org",contractName:"dev-1614562672208-5026434",walletUrl:"https://wallet.testnet.near.org"}),U=function(e){return{requests:e.requests,numCards:e.num_cards,purchaseVolume:S(e.purchase_volume),numPurchases:e.num_purchases,saleProfit:S(e.sale_profit),numSales:e.num_sales,numVotes:e.num_votes}},J=function(e){Object(b.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e))._near={},n._near.lsKey=G.contractName+":v01:",n._near.lsKeyRecentCards=n._near.lsKey+"recentCards",n.state={connected:!1,isNavCollapsed:!0,account:null,requests:null,recentCards:D.a.get(n._near.lsKeyRecentCards)||[]},n._initNear().then((function(){n.setState({signedIn:!!n._near.accountId,signedAccountId:n._near.accountId,connected:!0})})),n}return Object(m.a)(a,[{key:"_initNear",value:function(){var e=Object(u.a)(o.a.mark((function e(){var t,a,n,r,c=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new p.keyStores.BrowserLocalStorageKeyStore,e.next=3,p.connect(Object.assign({deps:{keyStore:t}},G));case 3:return a=e.sent,this._near.keyStore=t,this._near.near=a,this._near.walletConnection=new p.WalletConnection(a,G.contractName),this._near.accountId=this._near.walletConnection.getAccountId(),this._near.account=this._near.walletConnection.account(),e.next=11,this._near.account.connection.provider.block({finality:"final"});case 11:if(n=e.sent,this._near.lastBlockHeight=n.header.height,this._near.contract=new p.Contract(this._near.account,G.contractName,{viewMethods:["get_account","get_accounts","get_num_cards","get_top","get_rating","get_trade_data","get_card_info"],changeMethods:["register_account","vote","buy_card"]}),this._near.getAccount=function(){var e=Object(u.a)(o.a.mark((function e(t){var a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c._near.contract.get_account({account_id:t});case 2:return a=e.sent,e.abrupt("return",a?U(a):null);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),!this._near.accountId){e.next=26;break}return e.next=18,this._near.getAccount(this._near.accountId);case 18:if(null!==(r=e.sent)){e.next=25;break}return e.t0=U,e.next=23,this._near.contract.register_account();case 23:e.t1=e.sent,r=(0,e.t0)(e.t1);case 25:this.setState({account:r,requests:r.requests});case 26:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"requestSignIn",value:function(){var e=Object(u.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),"Berry Cards",e.next=4,this._near.walletConnection.requestSignIn(G.contractName,"Berry Cards");case 4:return e.abrupt("return",!1);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"logOut",value:function(){var e=Object(u.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._near.walletConnection.signOut(),this._near.accountId=null,this.setState({signedIn:!!this._accountId,signedAccountId:this._accountId});case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"popRequest",value:function(e){var t=this.state.requests.slice(1);this.setState({requests:t},e)}},{key:"addRequest",value:function(e,t){var a=this.state.requests.slice(0);a.push(e),this.setState({requests:a},t)}},{key:"addRecentCard",value:function(e){var t=this.state.recentCards.slice(0),a=t.indexOf(e);-1!==a&&t.splice(a,1),t.unshift(e),t=t.slice(0,10),D.a.set(this._near.lsKeyRecentCards,t),this.setState({recentCards:t})}},{key:"render",value:function(){var e=this,t=Object(l.a)({_near:this._near,updateState:function(t,a){return e.setState(t,a)},popRequest:function(t){return e.popRequest(t)},addRequest:function(t,a){return e.addRequest(t,a)},addRecentCard:function(t){return e.addRecentCard(t)}},this.state),a=this.state.connected?this.state.signedIn?r.a.createElement("div",null,r.a.createElement("button",{className:"btn btn-outline-secondary",onClick:function(){return e.logOut()}},"Sign out (",this.state.signedAccountId,")")):r.a.createElement("div",null,r.a.createElement("button",{className:"btn btn-primary",onClick:function(t){return e.requestSignIn(t)}},"Sign in with NEAR Wallet")):r.a.createElement("div",null,"Connecting... ",r.a.createElement("span",{className:"spinner-grow spinner-grow-sm",role:"status","aria-hidden":"true"}));return r.a.createElement("div",{className:"App"},r.a.createElement(I.a,{basename:""},r.a.createElement("nav",{className:"navbar navbar-expand-lg navbar-light bg-light mb-3"},r.a.createElement("div",{className:"container-fluid"},r.a.createElement(I.b,{className:"navbar-brand",to:"/",title:"NEAR.fm"},r.a.createElement("img",{src:h.a,alt:"Berry Cards",className:"d-inline-block align-middle"}),"[TESTNET] Berry Cards"),r.a.createElement("button",{className:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarSupportedContent","aria-controls":"navbarSupportedContent","aria-expanded":"false","aria-label":"Toggle navigation"},r.a.createElement("span",{className:"navbar-toggler-icon"})),r.a.createElement("div",{className:"collapse navbar-collapse",id:"navbarSupportedContent"},r.a.createElement("ul",{className:"navbar-nav me-auto mb-2 mb-lg-0"},r.a.createElement("li",{className:"nav-item"},r.a.createElement(I.b,{className:"nav-link","aria-current":"page",to:"/"},"Home")),this.state.signedIn&&r.a.createElement("li",{className:"nav-item"},r.a.createElement(I.b,{className:"nav-link","aria-current":"page",to:"/discover"},"Discover"))),r.a.createElement("form",{className:"d-flex"},a)))),r.a.createElement("a",{className:"github-fork-ribbon right-bottom fixed",href:"https://github.com/evgenykuzyakov/berry-hot","data-ribbon":"Fork me on GitHub",title:"Fork me on GitHub"},"Fork me on GitHub"),r.a.createElement(P.c,null,r.a.createElement(P.a,{exact:!0,path:"/"},this.state.signedIn?r.a.createElement(F,t):r.a.createElement(B,t)),r.a.createElement(P.a,{exact:!0,path:"/discover"},r.a.createElement(B,t)),r.a.createElement(P.a,{exact:!0,path:"/c/:cardId"},r.a.createElement(H,t)))))}}]),a}(r.a.Component);s.a.render(r.a.createElement(J,null),document.getElementById("root"))},99:function(e,t,a){e.exports=a.p+"static/media/logo.f18e89c9.png"}},[[108,1,2]]]);
//# sourceMappingURL=main.35e749cb.chunk.js.map